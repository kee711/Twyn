# 멀티 플랫폼 포스팅 로드맵

## 배경
- 현재 작성/게시 플로우는 Threads 단일 플랫폼만 대상으로 구현되어 있음.
- 사용자는 RightSidebar 상단 UI에서 Threads, X, Farcaster 각각의 게시 여부를 토글하고, "Unlink" 모드일 때 플랫폼별로 서로 다른 내용을 작성하고자 함.
- Publish/Schedule 처리, 캘린더 및 리스트 뷰 역시 플랫폼별 게시 상태를 시각적으로 표현해야 함.

## 단계별 로드맵

### 1. 상태 및 데이터 모델 기초 작업
1. ✅ `useThreadChainStore` 확장: 플랫폼별 콘텐츠 맵과 활성화 상태가 도입되어 Unlink/Link 전환을 지원한다.
2. ✅ `useSocialAccountStore`를 전면 교체하여 `user_selected_accounts`(신규 테이블)에 맞춘 플랫폼별 선택/토글을 지원한다.
3. ✅ RightSidebar/Selector에서 사용할 플랫폼 메타데이터 및 헬퍼 인터페이스를 정비하였다.

### 2. RightSidebar 상단 UI 구현
1. ✅ Unlink/Link 토글 및 Threads/X/Farcaster 버튼을 재구현하고, 플랫폼별로 에디터 데이터가 분기된다.
2. ✅ 버튼 토글 시 ThreadChain 스토어의 `activePlatforms`가 최신화되며, UI도 상태를 반영한다.
3. 🔄 언링크 모드 전환 시 데이터 동기화 로직은 기초 구현 완료, 세부 손실 방지 로직은 추가 점검 예정.

### 3. 에디터 콘텐츠 분기 처리
1. ThreadChain/PostCard가 `platformContents`를 인지하도록 수정하고, 선택된 플랫폼에 따라 다른 내용을 편집/표시하도록 한다.
2. Unlink 모드에서 플랫폼 버튼 클릭 시 해당 플랫폼의 콘텐츠를 로딩/저장하는 훅을 구현한다.
3. 링크 모드(단일 콘텐츠)와 언링크 모드(플랫폼별 콘텐츠) 간 전환 시 데이터 손실이 없도록 동기화 규칙을 정리한다.

### 4. 게시/예약 서버 액션 확장
1. `postThreadChain`/`scheduleThreadChain` 액션을 리팩터링하여 플랫폼별 파라미터(활성화 여부, 콘텐츠)를 입력으로 받도록 한다.
2. Threads 외 플랫폼(X, Farcaster)에 대한 게시/예약 함수 또는 API 연동을 추가하고, 실패 시 대응 전략을 정의한다.
3. 게시/예약 결과를 `my_contents` 또는 신규 테이블에 플랫폼별로 기록하도록 저장 로직을 확장한다.

### 5. 캘린더/리스트 뷰 확장
1. `getContents` 및 관련 쿼리를 수정하여 플랫폼 정보를 반환하도록 하고, 필요 시 스키마 변경을 계획한다.
2. `components/schedule/Calendar.tsx`, `List.tsx`에서 이벤트 카드를 플랫폼별 배지 또는 아이콘으로 표시하게 업데이트한다.
3. 편집/상세 모달에서 플랫폼별 콘텐츠를 확인/수정할 수 있도록 UI를 조정한다.

### 6. QA 및 후속 작업
1. 🔄 다국어 키/문구는 1차 추가 완료(모달/토스트 등), 전체 UX 관점에서 추가 문구 점검 필요.
2. ⚠️ 멀티 플랫폼 게시/스케줄/조회에 대한 테스트 커버리지가 부족하므로 추후 e2e 및 통합 테스트 보강이 필요하다.
3. 🔄 문서화 업데이트 진행 중 – 신규 테이블(`user_selected_accounts`, `x_accounts`)과 연동 플로우 설명을 추가 예정.

## 즉시 다음 작업
- **태스크 1:** Threads/X/Farcaster 게시 및 스케줄 서버 액션이 `user_selected_accounts` 정보를 사용하도록 마이그레이션한다.
- **태스크 2:** 캘린더/통계/댓글 등 Background job이 Threads 계정 미선택 시 안전하게 스킵하도록 후속 정리한다.
- **태스크 3:** UI에서 멀티 계정 표시(토글/라디오)와 Farcaster 즉시 로그인(SignInButton)이 완료되었으므로 잔여 스타일/접근성 점검을 진행한다.

위 순서대로 진행하면서 필요시 추가 세부 작업을 보강한다.

## 현재 한계와 추가로 필요한 것들
- X와 Farcaster 즉시 게시만 지원되며, 예약 발행·피드백 처리를 위해서는 각각의 스케줄러/토큰 자동 갱신 로직을 확장해야 한다.
- 예약 시 DB(`my_contents`)는 여전히 단일 `social_id` 컬럼을 사용하므로, 플랫폼별 저장 구조(예: 다중 row 또는 JSON 컬럼) 설계가 필요하다.
- 캘린더/리스트 뷰는 현재 선택된 `social_id` 기준으로만 데이터를 가져오므로, 멀티 플랫폼 정보를 함께 불러오고 로고/배지를 표시하도록 API와 UI를 모두 조정해야 한다.
- 계정 연결 플로우는 이제 Threads/X/Farcaster 모두 UI에서 노출되지만, 백엔드 토큰 보존/리프레시(특히 Farcaster) 정책을 명확히 해야 한다.
